# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды для установки зависимости и запуска проекта в режиме разработки, соответственно.

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка
Для сборки проекта в продакшн необходимо выполнить команду сборки в режиме разработки.\
Для данного проекта нет ограничений по использованию пакетного менеджера, поэтому можно использовать также YARN или PNPM.

```
npm run build
```

или

```
yarn build
```
## Данные и их типы, используемые в проекте
<!-- Типы данных будут использоваться в основе бизнес-логики. -->
### Интерфейсы данных 
1. Карточка товара.
Данный интерфейс описывает получаемые данные с сервера, которые будут создавать карточку товара в приложении.

```
interface iProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number;
}
```
2. Данные пользователя.
Данный интерфейс описывает получаемые данные пользователя, при заполнений формы.

```
interface iCustomer { 
  address: string;
  email: string;
  telephone: string;
}
```
3. Интерфейс для хранения данных карточек товаров и методов их реализации.
Данный интерфейс описывает получаемые данные товаров с сервера, которые будут создавать коллекцию карточек в приложении. И позволяет сохранять идентификатор выбранной карточки. 

```
interface iProductsData {
  productCards: iProduct[];
  previewCardById: string | null ;
}
```
### Типы данных компонентов приложения

1. Данные карточки, используемые для отображении товара на странице.

```
type TProductCard = Omit<iProduct, 'description'>;

```
2. Данные карточки, используемые для отображения информации о товаре через модальное окно.
```
type TProductInfoCard = Omit<iProduct, 'id'>;
```
3. Данные карточки, используемые для отображения информации о карточке в корзине.

```
type TProductFromCart = Pick<iProduct, 'title' | 'price'>;
```
4. Данные способа оплаты пользователя, вводимые при оформлении заказа через модальное окно.

```
type TCustomerPay = Pick<iCustomer, 'address'>;
```
5. Данные пользователя, в которых о передает контактные данные при оформлении заказа через модальное окно.
```
type TCustomerInfo = Pick<iCustomer, 'telephone' | 'email'>;
```
## Архитектура приложения

Код приложения разделен на три слоя (и один дополнительный), согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице;
- слой данных, отвечает за хранение и изменение данных;
- коммуникационный слой, отвечает за связь с бэкендом.
- презентер, отвечает за связь представления и данных.

### Базовый код
<!-- Описание основных классов проекта, которые будут использоваться в основе практически всех частей проекта. -->

#### Класс Api
Содержит в себе базовую логику запросов. В кноструктор передается базовый адрес сервера и опциональный объект с загаловками запросов.
- `constructor(baseUrl: string, options: RequestInit = {})`- принимает базовый URL и глобальные опции для всех запросов(опционально).

Методы: 
- `handleResponse(response: Response): Promise<object>` - обрабатывает ответ от сервера.
- `get(uri: string)` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер;
- `post(uri: string, data: object, method: ApiPostMethods = 'POST')` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт, переданный как параметр при вызове метода. По умолчанию выполняется 'POST'-запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове. Может принимать дополнительный параметр указания ссылки для отправки запроса.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презенторе для обработки событий и в слоях приложения для генерации событий.\
Конструктор создает коллекцию с указанием типов для ключей и их значений.
- `this._events = new Map<EventName, Set<Subscriber>>()` - принимает название события и уникального обработчика события.

Основные методы, реализуемые класс описаны интерфейсом `IEvents`:
- `on<T extends object>(eventName: EventName, callback: (event: T) => void)` - подписка на события. Принимает название события и функциб коллбэка для обработки события с обобщенным типом.;
- `emit<T extends object>(eventName: string, data?: T)` - инициализация события. Принимает название события и данные для инициализации события с обобщенным типом.;
- `trigger<T extends object>(eventName: string, context?: Partial<T>)` - возвращает функцию, при вызове которой инициализуется требуемое в параметрах событие. Принимает название события и данные для инициализации события с обобщенным типом.


### Слой данных

#### Класс CardsData
Класс отвечает за хранение и логику работы с данными карточек, полученных с сервера.\
Конструктор класса принимает инстант брокера событий.
- `constructor(events: IEvents)`

В полях класса хранятся следующие данные: 
- _productCards: iProduct[ ] - массив объектов карточек;
- _previewCardById: string | null - идентификатор выбранной карточки, для просмотра в модальном окне;
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс имеет набор методов для взаимодействия с этими данными:
- addProductCard(product: iProduct): void - добавляет выбранную карточку товара в конец массива объектов корзины покупок и вызывает событие изменения этого массива;
- getProductCard(cardId: string): iProduct - возвращает выбранную карточку с данным идентификатором.
- сеттеры и геттеры для сохранения и получения данных из полей класса.

#### Класс CustomersData
Класс отвечает за хранение данных пользователя и проверку валидации полей формы, заполняемых пользователем перед оформлением заказа.\
Конструктор класса принимает инстант брокера событий.
- `constructor(events: IEvents)`

В полях класса хранятся следующие данные:
- address: string - адрес доставки заказа; 
- email: string - электронная почта покупателя;
- telephone: string - контактный телефон покупателя;
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс имеет набор методов для взаимодействия с этими данными:
- setCustomerInfo(customerData: iCustomer): void - сохраняет данные покупателя в классе;
- checkValidation(data: Record<keyof TCustomerPay, string>): boolean - проверяет валидность полей формы выбора оплаты.
- checkValidation(data: Record<keyof TCustomerInfo, string>): boolean - проверяет валидность полей формы личных данных.

### Слой представления
Классы этого слоя отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.\

#### Класс View
Базовый класс, который отвечает за логику управления DOM-элементами. В нем будут реализовываться действия основные дейтсвия пользователя со страницей.
Поля класса:
- button: HTMLButtonElement - DOM-элемент кнопки;
- buttonAlt: HTMLButtonElement - DOM-элемент нажатой кнопки;
- inputAddress: HTMLInputElement - DOM-элемент ввода адреса;
- inputEmail: HTMLInputElement - DOM-элемент ввода электронной почты;
- inputTelephone: HTMLInputElement - DOM-элемент ввода контактного телефона;
Методы класса:
- disableButton(button: HTMLButtonElement, status: boolean): void - отключает кнопку;
- setButton(button: HTMLButtonElement, status: boolean): void - выделяет кнопку;
- setAddress(address: string): void - устанавливает адрес;
- setEmail(email: string): void - устанавливает электронную почту;
- setTelephone(telephone: string): void - устанавливает контактный телефон.

#### Класс Modal
Реализует модальное окно. Так же предоставляет метода `open` и `close` для управления отображением модального окна.  Устанавливает слушатели на клавиатуру, для закрытия модального окна по нажатию клавиши Esc, на клик в оверлей вне модального окна и кнопку-крестик для закрытия модального окна.

- `constructor(selector: string, events: IEvents)` Конструктор принимает в качестве параметров селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- modal: HTMLElement - DOM-элемент модального окна;
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных;
- submitButton: HTMLButtonElement - DOM-элемент кнопки отправки формы;
- cardTitle: HTMLElement - DOM-элемент названия карточки;
- cardPrice: HTMLElement - DOM-элемент цены карточки.
- cardPriceCount: number - общая стоимость корзины;
- handleSubmit: Function - функция, отвечающая за открытие следующего модального окна;

Методы класса:
- open(element: HTMLElement): void - открывает модальное окно;
- close(element: HTMLElement): void - закрывает модальное окно.

#### Класс ModalWithCardInfo
Расширяет класс Modal. Предназначен для реализации модального окна просмотра карточки товара. При открытии модального окна сохраняется полученный в параметрах обработчик, который передается для выполнения при нажатии на кнопку добавления товара в корзину и получает данные объекта карточки через шаблон, которую нужно показать. Предоставляет управления активности кнопки добавления в корзину.\
Поля класса:
- cardCategory: HTMLElement - DOM-элемент категории карточки;
- cardImage: HTMLElement - DOM-элемент картинки карточки;
- cardText: HTMLElement - DOM-элемент описания карточки;

Методы: 
- setValid(isValid: boolean): void - устанавливает состояние кнопки добавления в корзину;
- open(data: TProductInfoCard, handleSubmit: Function): void - расширение родительского метода, принимает объект реализованный именованным типом `TProductInfoCard` и обработчик, который передается при инициации события добавления товара в корзину.
- close(): void - расширяет родительский метод, выполняет закрытие модального окна при добавлении товара в корзину.

#### Класс ModalWithCart
Расширяет класс Modal. Предназначен для реализации модального окна с содержимым корзины. При открытии модального окна сохраняется полученный в параметрах обработчик, который передается для выполнения при нажатии на кнопку добавления товара в корзину. Получает данные карточки и метод для подсчета стоимости товара в корзине, а так же счетчик количество добавленных в корзину карточек. Предоставляет управления активности кнопки оплаты.\
Поля класса:
- cardList: HTMLElement - DOM-элемент списка карточек;
- cardIndex: number - индекс карточки в корзине;

Методы: 
- open(data: TProductFromCart[], handleSubmit: Function): void - расширение родительского метода, открывает модальное окно и принимает объект реализованный типом `TProductFromCart`. Полученный в параметрах обработчик передается для выполнения при нажатии на кнопку оформления заказа.
- setValid(isValid: boolean): void - устанавливает состояние кнопки на оформление заказа, исходя от заполненности корзины;
- deleteProduct(cardId: string, notification: Function | null): void - удаляет карточку из массива корзины. Если передан колбэк, то выполняет его после удаления, если нет, то вызывает событие изменения массива;

#### Класс ModalWithForm
Расширяет класс Modal. Предназначен для реализации модального окна с формой содержащей кнопки выбора способа оплаты и полями ввода. При сабмите инициирует событие, передавая в него объект с данными из полей ввода формы. Предоставляет метод для отображения ошибок при вводе данных и управления активности кнопки отправки формы.
Поля класса: 
- _form: HTMLFormElement - DOM-элемент формы;
- formName: string - значение атрибута name формы;
- inputs: NodeListOf<HTMLInputElement> - коллекция всех полей ввода формы;
- errors: Record<string, HTMLElement> - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов. 

Методы:
- open(data: iCustomer, handleSubmit: Function): void - расширение родительского метода, полученный в параметрах обработчик передается для выполнения при нажатии на кнопку оплаты;
- setValid(isValid: boolean): void - устанавливает состояние кнопки оплаты, исходя от валидности полей ввода;
- getInputValues(): Record<string, string> - возвращает объект с данными из полей ввода формы, где ключ - атрибут name инпута, значение - содержимое инпута;
- setError(data: {field: string, value: string, validInformation: string}): void - добавляет объект с данными для отображения или сокрытия текстов ошибок под полями ввода;
- showInputError(field: string, errorMessage: string): void - отображает полученный текуст ошибки под указанным полем ввода;
- hideInputError(field: string): void - очищает текст ошибки под указанным полем ввода;
- getForm(): HTMLFormElement - возвращает DOM-элемент формы;

#### Класс ModalOrderComplete
Расширяет класс Modal. Предназначен для реализации модального окна с сообщением об успешном оформлении заказа. При открытии модального окна указывается сообщение об успешном оформлении заказа и списании средств. Так же сохраняется полученный в параметрах обработчик, который передается для выполнения при нажатии на кнопку отправки формы.

Методы: 
- open(data: {priceCount: number}): number - расширяет родительский метод, передавая в него общую стоимость корзины;
- close(): void - расширяет родительский метод, выполняя очистку коллекции корзины при успешном оформлении заказа.

#### Класс CardProduct
Отвечает за отображение карточки, задавая в карточке данные категории, названия, изображения, описания и цены. Класс используется для отображения карточек на странице сайти. В конструктор класса передается DOM-элемент темплейта, что позволяет, при необходимости, формировать карточки разных вариантов верстки.\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта, принимает экземпляр `EventEmitter` для управления событиями.\
Методы:
- setData(cardData: iProduct): void - заполняет атрибуты элементов карточки данными;
- render(): HTMLElement - отрисовывает карточку на странице;
- геттер id возвращает уникальный идентификатор карточки.

#### Класс CardsContainer
Отвечает за отображение блока с карточками на главной странице. Предоставляет метод `addCard(cardElement: HTMLElement)`, который добавляет карточку на страницу и сеттер `container` для полного обновления содержимого. В кноструктор принимает контейнер, в котором размещаются карточки.\

#### Класс CartList
Отвечает за отображения карточек, добавленных в корзину. Предоставляет метод `addCard(cardElement: HTMLElement)`, который добавляет карточку на страницу. В кноструктор принимает контейнер, в котором размещаются карточки.\


### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкенд сервисом.

## Взаимодействие компонентов с пользовательским интерфейсом 
Код, описающий взаимодействие представления и данных между собой, находится в файле `index.ts`, выполняющем роль презентора.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*
*События изменения данных (генерируются классами моделей данных)*:
- `cards:change` - изменения массива карточек при вывода их на страницу или добавлении в корзину;
- `card:selected` - изменение данных открываемой карточки в модальном окне;
- `card:previewClear` - очистка данных, выбранной для показа в модальном окне, карточки.

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление):*
- `modalCart:open` - открытие модального окна корзины;
- `modalPayment:open` - открытие модального окна выбора способа оплаты;
- `modalContact:open` - открытие модального окна контактных данных покупателя;
- `modalComplete:open` - открытие модального окна завершения оформления заказа;
- `modalCard:open` - открытие модального окна карточки;
- `modalCart:close` - закрытие модального окна корзины;
- `modalPayment:close` - закрытие модального окна выбора способа оплаты;
- `modalContact:close` - закрытие модального окна контактных данных покупателя;
- `modalComplete:close` - закрытие модального окна завершения оформления заказа;
- `modalCard:close` - закрытие модального окна карточки;
- `card:select` - выбор карточки для отображения в модальном окне;
- `card:delete` - выбор карточки для удаления в корзине;
- `modalPayment:input` - ввод данных способа оплаты в модальном окне оформления заказа;
- `modalContact:input` - ввод контактных данных в модальном окне оформления заказа;
- `modalCard:submit` - событие, генерируемой при добавлении выбранной карточки в корзину;
- `modalCart:submit` - начало оформление заказа;
- `modalPayment:submit` - подтверждение введенных данных способа оплаты;
- `modalContact:submit` - подтверждение введенных контактных данных;
- `modalComplete:submit` - подтверждение оформления заказа;
- `inputFormPayment:validation` - событие, сообщающее о необходимости валидации полей ввода формы способа оплаты;
- `inputFormContact:validation` - событие, сообщающее о необходимости валидации полей ввода формы данных покупателя;
